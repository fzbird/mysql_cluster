# ========================================================================
# MySQL 集群环境变量配置文件 - 跨平台兼容版本
# ========================================================================
# 
# 支持系统: Windows, Linux, macOS
# 此文件用于配置 MySQL 主从复制集群的环境变量
# 使用方法: docker-compose -f docker-compose.mysql-cluster.yml --env-file mysql-cluster.env up -d
#
# 重要说明：
# 1. 修改密码后请确保所有相关配置文件同步更新
# 2. 生产环境中请使用更强的密码
# 3. 请妥善保管此配置文件，避免泄露敏感信息
#
# ========================================================================

# ========================================================================
# 基本 MySQL 配置
# ========================================================================

# MySQL 根用户密码（超级管理员）
MYSQL_ROOT_PASSWORD=fzbird20250615

# 默认数据库名称
MYSQL_DATABASE=gallery_db

# 应用数据库用户和密码
MYSQL_USER=gallery_user
MYSQL_PASSWORD=gallery_password_2024

# ========================================================================
# 复制配置
# ========================================================================

# 复制用户配置（用于主从复制）
MYSQL_REPLICATION_USER=replicator
MYSQL_REPLICATION_PASSWORD=repl_password_2024

# ========================================================================
# 端口映射配置
# ========================================================================

# MySQL 服务器端口
MYSQL_MASTER_PORT=3306
MYSQL_SLAVE_PORT=3307

# HAProxy 端口配置
MYSQL_PROXY_WRITE_PORT=3308
MYSQL_PROXY_READ_PORT=3309
MYSQL_PROXY_STATS_PORT=8404

# 监控服务端口
MYSQL_MONITOR_PORT=9104

# ========================================================================
# 应用用户配置（用于读写分离）
# ========================================================================

# 只读用户（用于从服务器查询）
MYSQL_READER_USER=gallery_reader
MYSQL_READER_PASSWORD=reader_password_2024

# 读写用户（用于主服务器操作）
MYSQL_WRITER_USER=gallery_writer
MYSQL_WRITER_PASSWORD=writer_password_2024

# 监控用户（用于监控服务）
MYSQL_MONITOR_USER=monitor
MYSQL_MONITOR_PASSWORD=monitor_password_2024

# ========================================================================
# 性能调优配置
# ========================================================================

# InnoDB 缓冲池大小
MYSQL_INNODB_BUFFER_POOL_SIZE=256M

# 最大连接数
MYSQL_MAX_CONNECTIONS=1000

# 查询缓存大小（MySQL 8.0+ 已弃用，设为0）
MYSQL_QUERY_CACHE_SIZE=0

# 慢查询日志时间阈值（秒）
MYSQL_SLOW_QUERY_TIME=2

# 二进制日志保留天数
MYSQL_BINLOG_EXPIRE_DAYS=7

# 二进制日志文件最大大小
MYSQL_MAX_BINLOG_SIZE=100M

# 并行复制工作线程数
MYSQL_SLAVE_PARALLEL_WORKERS=4

# ========================================================================
# 集群配置
# ========================================================================

# 集群名称
MYSQL_CLUSTER_NAME=gallery-cluster

# 集群版本
MYSQL_CLUSTER_VERSION=2.0

# 集群描述
MYSQL_CLUSTER_DESCRIPTION="MySQL Master-Slave Replication Cluster"

# ========================================================================
# 备份配置
# ========================================================================

# 备份计划（Cron 表达式）
MYSQL_BACKUP_SCHEDULE="0 2 * * *"

# 备份保留天数
MYSQL_BACKUP_RETENTION_DAYS=7

# 备份压缩（true/false）
MYSQL_BACKUP_COMPRESS=true

# 备份目录
MYSQL_BACKUP_DIR=./mysql-cluster-backups

# ========================================================================
# 功能开关
# ========================================================================

# 启用监控服务
MYSQL_ENABLE_MONITORING=true

# 启用HAProxy负载均衡
MYSQL_ENABLE_HAPROXY=true

# 启用慢查询日志
MYSQL_ENABLE_SLOW_QUERY_LOG=true

# 启用通用查询日志
MYSQL_ENABLE_GENERAL_LOG=true

# 启用二进制日志
MYSQL_ENABLE_BINLOG=true

# 启用GTID模式
MYSQL_ENABLE_GTID=true

# ========================================================================
# 安全配置
# ========================================================================

# 启用SSL（生产环境建议开启）
MYSQL_ENABLE_SSL=false

# SSL 证书文件路径
MYSQL_SSL_CERT_PATH=

# SSL 私钥文件路径
MYSQL_SSL_KEY_PATH=

# SSL CA 证书文件路径
MYSQL_SSL_CA_PATH=

# 允许的主机模式（%表示所有主机）
MYSQL_ALLOW_HOSTS=%

# ========================================================================
# 日志配置
# ========================================================================

# 日志级别（ERROR, WARN, INFO, DEBUG）
MYSQL_LOG_LEVEL=INFO

# 错误日志文件路径
MYSQL_ERROR_LOG_PATH=/var/log/mysql/mysql-error.log

# 慢查询日志文件路径
MYSQL_SLOW_LOG_PATH=/var/log/mysql/mysql-slow.log

# 通用日志文件路径
MYSQL_GENERAL_LOG_PATH=/var/log/mysql/mysql-general.log

# 二进制日志文件前缀
MYSQL_BINLOG_PREFIX=mysql-bin

# 中继日志文件前缀
MYSQL_RELAY_LOG_PREFIX=mysql-relay-bin

# ========================================================================
# 字符集和时区配置
# ========================================================================

# 字符集
MYSQL_CHARSET=utf8mb4

# 排序规则
MYSQL_COLLATION=utf8mb4_unicode_ci

# 时区
MYSQL_TIMEZONE=+08:00

# ========================================================================
# Docker 配置
# ========================================================================

# MySQL 镜像版本
MYSQL_VERSION=8.0

# HAProxy 镜像版本
HAPROXY_VERSION=2.8

# 监控服务镜像版本
MYSQLD_EXPORTER_VERSION=latest

# 容器重启策略
MYSQL_RESTART_POLICY=unless-stopped

# ========================================================================
# 资源限制配置
# ========================================================================

# 主服务器内存限制
MYSQL_MASTER_MEMORY_LIMIT=1G

# 从服务器内存限制
MYSQL_SLAVE_MEMORY_LIMIT=1G

# 主服务器内存预留
MYSQL_MASTER_MEMORY_RESERVATION=512M

# 从服务器内存预留
MYSQL_SLAVE_MEMORY_RESERVATION=512M

# 主服务器CPU限制
MYSQL_MASTER_CPU_LIMIT=1.0

# 从服务器CPU限制
MYSQL_SLAVE_CPU_LIMIT=1.0

# 主服务器CPU预留
MYSQL_MASTER_CPU_RESERVATION=0.5

# 从服务器CPU预留
MYSQL_SLAVE_CPU_RESERVATION=0.5

# ========================================================================
# 健康检查配置
# ========================================================================

# 健康检查间隔
MYSQL_HEALTHCHECK_INTERVAL=30s

# 健康检查超时
MYSQL_HEALTHCHECK_TIMEOUT=10s

# 健康检查重试次数
MYSQL_HEALTHCHECK_RETRIES=5

# 健康检查启动延迟
MYSQL_HEALTHCHECK_START_PERIOD=80s

# ========================================================================
# 网络配置
# ========================================================================

# 集群网络名称
MYSQL_CLUSTER_NETWORK=mysql-cluster-network

# 网络子网
MYSQL_CLUSTER_SUBNET=172.24.0.0/16

# 网络网关
MYSQL_CLUSTER_GATEWAY=172.24.0.1

# 网络MTU
MYSQL_CLUSTER_MTU=1500

# ========================================================================
# 开发和调试配置
# ========================================================================

# 开发模式（true/false）
MYSQL_DEV_MODE=false

# 调试模式（true/false）
MYSQL_DEBUG_MODE=false

# 详细日志（true/false）
MYSQL_VERBOSE_LOGGING=false

# 性能模式（true/false）
MYSQL_PERFORMANCE_MODE=false

# ========================================================================
# 额外配置
# ========================================================================

# 自定义配置标签
MYSQL_CUSTOM_LABELS=environment=production,team=devops

# 额外环境变量（如果需要）
MYSQL_EXTRA_ARGS=

# 集群描述信息
MYSQL_CLUSTER_TAGS=mysql,cluster,replication,ha 